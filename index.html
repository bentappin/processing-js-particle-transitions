<!DOCTYPE html>
<html>
<head>
  <script src="../processing.js"></script>
  <script src="../init.js"></script>
</head>
<body>
<p>
<script type="application/processing">
int numParticles = 20;
int minSize = 5;
int maxSize = 50;
Particle particles[] = new Particle[numParticles];
int frameCount = 0;
Transition[] transitions;

int[][] squareTransitionCoords = {
	// Left
	{10,20},
	{10,40},
	{10,60},
	{10,80},
	{10,100},
	// Right
	{100,20},
	{100,40},
	{100,60},
	{100,80},
	{100,100},
	// Bottom
	{20,100},
	{40,100},
	{60,100},
	{80,100},
	{100,100},
	// Top
	{20,10},
	{40,10},
	{60,10},
	{80,10},
	{100,10}
};

void setup() {
    size(800, 400);
	smooth();
	noStroke();
    background(0);
   
	for(int i=0; i < numParticles; i++) {
		particles[i] = new Particle(random(0,width), random(0,height), random(minSize, maxSize), random(0.0,0.5), random(0.0,0.5), color(random(255),random(255),random(255),random(255)));
	}
	
	transitions = new Transition[1];
	transitions[0] = new Transition(squareTransitionCoords, 400, 100);
}

void draw() {
	frameCount++;
	background(0);
	
	// Random positions
	if (frameCount % 1000 == 0 ) {
		for(int i=0; i < numParticles; i++) {
			particles[i].randomTarget();
		}
	}
	
	// Square Transition
	if (frameCount % 1000 == 0 ) {
		transitions[0].do(particles);
	}
	
	for(int i=0; i < numParticles; i++) {
		particles[i].update();
		particles[i].draw();
	}
}

class Particle {
	float xpos;
	float ypos;
	float xtarget;
	float ytarget;
	float easing = 0.175;
	float colour;
	float diameter;
	float xspeed;
	float yspeed;
	
	Particle(float xin, float yin, float din, float xsdin, float ysdin, Color cin) {
		xpos = xin;
		ypos = yin;
		diameter = din;
		colour = cin;
		xspeed = xsdin;
		yspeed = ysdin;
	}
	
	void update() {
		float dx = xtarget - xpos;
		if(abs(dx) > 1) {
		  xpos += dx * easing * xspeed;
		}

		float dy = ytarget - ypos;
		if(abs(dy) > 1) {
		  ypos += dy * easing * yspeed;
		}
		
	}
	
	void draw() {
		noStroke();
		fill(colour);
		ellipse(xpos, ypos, diameter, diameter);
	}
	
	void randomTarget() {
		xtarget = random(0,width);
		ytarget = random(0,height);
	}
}

class Transition {
	int[][] coords;
	int xoffset = 0;
	int yoffset = 0;
	
	Transition (int[][] coin) {
		coords = coin;
	}
	
	Transition (int[][] coin, int xoff, int yoff) {
		coords = coin;
		xoffset = xoff;
		yoffset = yoff;
	}
	
	void do(Particles[] ps) {
		for(int i=0; i < ps.length(); i++) {
			ps[i].xtarget = coords[i][0] + xoffset;
			ps[i].ytarget = coords[i][1] + yoffset;
		}
	}
}
</script>
<canvas width="800" height="400"></canvas></p>
<div style="height:0px;width:0px;overflow:hidden;"></div>
</body>
</html>
